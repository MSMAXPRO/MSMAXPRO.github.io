<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Basics (MongoDB) - CodeWithMSMAXPRO</title>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css"> 

</head>
<body>

    <header>
        <div class="container">
            <nav>
                <a href="/" class="logo">
                    <img src="images/logo.png" alt="CodeWithMSMAXPRO Logo">
                    <span>CodeWithMSMAXPRO</span>
                </a>
                
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="roadmaps.html">Roadmaps</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li> 
                </ul>
                
                <div class="hamburger">
                    <div class="line1"></div>
                    <div class="line2"></div>
                    <div class="line3"></div>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <section class="content-container">
            <div class="container"> <article class="content-body">
                    <div class="content-header">
                        <h1>Chapter 3: Databases (<span class="highlight">MongoDB</span> Basics)</h1>
                        <p class="content-meta">Backend Developer Roadmap</p>
                    </div>

                    <p>Our Express server can now send "Hello World" and even basic JSON data. But there's a problem: every time we stop and restart the server, all our data is lost! We need a way to store information **persistently**. This is where databases come in.</p>
                    <p>A **database** is an organized collection of data, stored electronically. Think of it as a super-smart filing cabinet for your application's information. Your backend server (Node.js/Express) will talk to the database to save new data (Create), retrieve existing data (Read), update it (Update), or delete it (Delete).</p>

                    <h2>Theory: SQL vs. NoSQL Databases</h2>
                    <p>Databases generally fall into two main categories:</p>
                    
                    <h3>1. SQL (Relational Databases) - The Organized Spreadsheet</h3>
                    <ul>
                        <li>Stores data in **tables** with predefined **columns** and **rows**.</li>
                        <li>Excels at defining **relationships** between tables.</li>
                        <li>Uses **SQL** to interact with data.</li>
                        <li>Examples: PostgreSQL, MySQL.</li>
                        <li>Pros: Data integrity, powerful querying for related data.</li>
                        <li>Cons: Less flexible schema, horizontal scaling can be harder.</li>
                    </ul>

                    <h3>2. NoSQL (Non-Relational Databases) - The Flexible Filing Cabinet</h3>
                    <ul>
                        <li>Offers more flexibility in how data is stored.</li>
                        <li>Key Concept: **Flexibility & Scalability**.</li>
                        <li>Types: Document (MongoDB), Key-Value (Redis), Column-Family (Cassandra), Graph (Neo4j).</li>
                        <li>Pros: Flexible schema, easier horizontal scaling, often fast.</li>
                        <li>Cons: Less strict relationship enforcement, consistency needs care.</li>
                    </ul>
                    
                    <div class="note">
                        <strong>Why MongoDB for Node.js?</strong> MongoDB is a **document database** storing data in BSON (like JSON). This fits naturally with JavaScript objects, making it intuitive for Node.js developers.
                    </div>

                    <h2>Theory: Introducing MongoDB & Mongoose üçÉ</h2>
                    
                    <h3>MongoDB Core Concepts</h3>
                    <p>MongoDB's structure:</p>
                    <ul>
                        <li>**Database:** Top-level container.</li>
                        <li>**Collection:** Group of related documents (like a flexible table).</li>
                        <li>**Document:** A single record in BSON format (like a JS object with a unique `_id`).</li>
                    </ul>

                    <h3>Mongoose: Making MongoDB Easier in Node.js</h3>
                    <p>**Mongoose** is an **ODM (Object Data Modeling)** library. It provides a structured way to interact with MongoDB from Node.js.</p>
                    <p>It helps with:</p>
                    <ul>
                        <li>**Schema Definition:** Defining a blueprint (structure, types, validation) for your documents.</li>
                        <li>**Models:** Creating tools from schemas to perform CRUD operations on collections.</li>
                        <li>**Data Validation:** Enforcing rules before saving.</li>
                        <li>**Query Building:** Cleaner syntax for database queries.</li>
                    </ul>

                    <h2>Task: Setting Up MongoDB & Connecting Securely</h2>
                    <p>Let's get a database and connect our Express app without exposing secrets.</p>
                    
                    <h3>Step 1: Get a MongoDB Database Instance</h3>
                    <p>Use the free tier on **MongoDB Atlas** (MongoDB's cloud service).</p>
                    
                    <h4>How to Perform (MongoDB Atlas Setup):</h4>
                    <ol>
                        <li>Sign up at <a href="https://www.mongodb.com/cloud/atlas" target="_blank">MongoDB Atlas</a>.</li>
                        <li>Create a **Free Tier Cluster**.</li>
                        <li>Configure Security: Create a **Database User** (note the username/password) and **Whitelist your IP** (`0.0.0.0/0` for development only).</li>
                        <li>Get Connection String: Click "Connect" -> "Connect your application". Copy the string. It will look like `mongodb+srv://<username>:<password>@yourclustername.mongodb.net/YOUR_DB_NAME?retryWrites=true&w=majority`.</li>
                        <li>**Crucially:** Replace `<username>`, `<password>`, and `YOUR_DB_NAME` with your actual credentials and a database name. **Keep this complete string safe and private! DO NOT put it directly in your code.**</li>
                    </ol>

                    <h3>Step 2: Install Mongoose & Dotenv</h3>
                    <p>Install Mongoose and `dotenv` (a package to manage environment variables).</p>                    
                    <h4>How to Perform (Terminal):</h4>
                    <p>In your project directory (e.g., `my-server`) run:</p>
<pre><code>npm install mongoose dotenv
</code></pre>

                    <h3>Step 3: Store Connection String Securely (Using `.env`)</h3>
                    <p>Never hardcode secrets like your database connection string directly in your `server.js` file, especially if your code is on GitHub.</p>
                    
                    <h4>How to Perform:</h4>
                    <ol>
                        <li>**Create `.env` file:** In the root of your project folder (next to `package.json`), create a new file named exactly `.env`.</li>
                        <li>**Add URI to `.env`:** Inside the `.env` file, add your connection string like this (no quotes needed):</li>
<pre><code class="language-bash"># Inside .env file
MONGO_URI=mongodb+srv://YOUR_USERNAME:YOUR_PASSWORD@yourcluster.mongodb.net/YOUR_DB_NAME?retryWrites=true&w=majority
</code></pre>
                        <li>**Create `.gitignore` file:** If you don't already have one, create a file named `.gitignore` in the root of your project.</li>
                        <li>**Add `.env` to `.gitignore`:** Inside the `.gitignore` file, add a new line:</li>
<pre><code class="language-bash"># Inside .gitignore file
.env
node_modules/ 
</code></pre>
                        <p>This tells Git to **ignore** the `.env` file, so your secrets are never committed or pushed to GitHub.</p>
                    </ol>

                    <h3>Step 4: Connect in Your `server.js` (Securely)</h3>
                    <p>Modify `server.js` to load the connection string from the environment variable defined in `.env`.</p>                    
                    <h4>How to Perform (Modify `server.js`):</h4>
<pre><code class="language-javascript">require('dotenv').config(); // 1. Load environment variables from .env file AT THE VERY TOP
const express = require('express');
const mongoose = require('mongoose'); 

const app = express();
const PORT = process.env.PORT || 3000;

// --- Database Connection ---
// 2. Access the connection string from process.env
const MONGO_URI = process.env.MONGO_URI; 

// Simple check if the URI loaded
if (!MONGO_URI) {
  console.error('FATAL ERROR: MONGO_URI is not defined in .env file');
  process.exit(1); // Exit if the connection string is missing
}

async function connectDB() {
  try {
    // 3. Use the loaded URI to connect
    await mongoose.connect(MONGO_URI); 
    console.log('MongoDB Connected Successfully! ‚úÖ');
    
    app.listen(PORT, () => {
      console.log(`Server listening on port ${PORT}`);
    });

  } catch (error) {
    console.error('MongoDB Connection Error: ‚ùå', error);
    process.exit(1); 
  }
}

connectDB(); // Call the function

// --- Basic Route (Example) ---
app.get('/', (req, res) => {
  const dbStatus = mongoose.connection.readyState === 1 ? 'Connected' : 'Disconnected';
  res.send(`Hello World! DB Status: ${dbStatus}`); 
});

// --- Other routes and middleware will go here later ---

</code></pre>

                    <h4>Theory: Understanding the Secure Connection</h4>
                    <ul>
                        <li>**`require('dotenv').config();`:** This line **must be at the very top** of your file. It loads the variables defined in your `.env` file and makes them available on the global `process.env` object in Node.js.</li>
                        <li>**`process.env.MONGO_URI`:** Node.js automatically provides the `process.env` object. After running `dotenv.config()`, `process.env` will contain all the variables from your `.env` file. We access our connection string using the key we defined (`MONGO_URI`).</li>
                        <li>**Security:** Your secret connection string now lives *only* in the `.env` file on your local machine (and needs to be set up separately on your deployment server). It's never committed to Git, keeping your credentials safe.</li>
                    </ul>
                    
                    <h4>How to Perform (Testing the Connection):</h4>
                    <ol>
                        <li>Ensure you have created the `.env` file with the correct `MONGO_URI`.</li>
                        <li>Ensure you have added `.env` to your `.gitignore` file.</li>
                        <li>Save `server.js`, `.env`, and `.gitignore`.</li>
                        <li>Run `node server.js` in your terminal.</li>
                        <li>You should see the `MongoDB Connected Successfully! ‚úÖ` message. If you see the "FATAL ERROR" message, double-check your `.env` file name and the variable name `MONGO_URI`. If you see a connection error, check the string details and Atlas IP whitelist.</li>
                    </ol>
                    <p>Now your connection setup is secure!</p>

                    <h2>Task: Defining Data Structure with Schemas & Models</h2>
                    <p>(This section remains the same as before, defining the schema and model)</p>
                    
                    <h3>Schema: The Blueprint üìú</h3>
                    <h4>How to Perform (Add after `connectDB()` call):</h4>
<pre><code class="language-javascript">// --- Define Schema & Model ---
const { Schema } = mongoose; 

const userSchema = new Schema({
  username: { type: String, required: true, unique: true, trim: true, minlength: 3 },
  email: { type: String, required: true, unique: true, trim: true, lowercase: true, match: [/.+\@.+\..+/, 'Invalid Email'] },
  age: { type: Number, min: 13, max: 120 },
  isVerified: { type: Boolean, default: false },
  createdAt: { type: Date, default: Date.now, immutable: true },
  updatedAt: { type: Date, default: Date.now }
});

userSchema.pre('save', function(next) {
  this.updatedAt = Date.now();
  next();
});
</code></pre>

                    <h3>Model: The Working Tool üõ†Ô∏è</h3>
                    <h4>How to Perform (Add after schema definition):</h4>
<pre><code class="language-javascript">// Create the 'User' model
const User = mongoose.model('User', userSchema); 
</code></pre>

                    <h2>Task: Performing CRUD Operations with Mongoose</h2>
                    <p>(This section also remains the same, defining the CRUD routes)</p>
                    
                    <h3>Middleware Setup: `express.json()`</h3>
                    <h4>How to Perform (Add near the top):</h4>
<pre><code class="language-javascript">// --- Middleware ---
app.use(express.json()); 
</code></pre>

                    <h3>1. Create (POST /users)</h3>
                    <h4>How to Perform (Add route definition):</h4>
<pre><code class="language-javascript">// --- CRUD Routes for Users ---
app.post('/users', async (req, res) => {
  try {
    const newUser = new User(req.body); 
    const savedUser = await newUser.save(); 
    res.status(201).json(savedUser); 
  } catch (error) {
    res.status(400).json({ message: "Error creating user", details: error.message }); 
  }
});
</code></pre>

                    <h3>2. Read (GET /users, GET /users/:id)</h3>
                    <h4>How to Perform (Add route definitions):</h4>
<pre><code class="language-javascript">// READ all users
app.get('/users', async (req, res) => {
  try {
    const users = await User.find(); 
    res.json(users);
  } catch (error) {
    res.status(500).json({ message: "Error fetching users", details: error.message });
  }
});

// READ one user by ID
app.get('/users/:id', async (req, res) => {
  try {
    const user = await User.findById(req.params.id); 
    if (!user) return res.status(404).json({ message: 'User not found' });
    res.json(user);
  } catch (error) {
    res.status(500).json({ message: "Error fetching user", details: error.message });
  }
});
</code></pre>
                    
                    <h3>3. Update (PATCH /users/:id)</h3>
                    <h4>How to Perform (Add route definition):</h4>
<pre><code class="language-javascript">// UPDATE a user by ID
app.patch('/users/:id', async (req, res) => {
  try {
    const updatedUser = await User.findByIdAndUpdate(
      req.params.id, 
      req.body, 
      { new: true, runValidators: true } 
    );
     if (!updatedUser) return res.status(404).json({ message: 'User not found' });
    res.json(updatedUser);
  } catch (error) {
    res.status(400).json({ message: "Error updating user", details: error.message }); 
  }
});
</code></pre>

                    <h3>4. Delete (DELETE /users/:id)</h3>
                    <h4>How to Perform (Add route definition):</h4>
<pre><code class="language-javascript">// DELETE a user by ID
app.delete('/users/:id', async (req, res) => {
  try {
    const deletedUser = await User.findByIdAndDelete(req.params.id);
     if (!deletedUser) return res.status(404).json({ message: 'User not found' });
    res.json({ message: 'User deleted successfully' });
  } catch (error) {
    res.status(500).json({ message: "Error deleting user", details: error.message });
  }
});
</code></pre>

                    <h2>Conclusion: Persistent & Secure Data Power! üí™</h2>
                    <p>You've now learned how to securely connect your Node.js/Express backend to MongoDB using environment variables and Mongoose. You understand Schemas, Models, and CRUD operations. Your backend can now safely manage persistent data, a cornerstone of web development!</p>

                </article>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 CodeWithMSMAXPRO. All rights reserved.</p>
        </div>
    </footer>
    
    <script src="app.js"></script> 

</body>
</html>
